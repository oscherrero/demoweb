<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=no, orientation=portrait">
  <link rel="manifest" href="/demoweb/manifest.json">
  <link rel="stylesheet" href="/demoweb/style.css">
  <title>Demo</title>
  <link rel="link icon " href="https://premierpigs.com/wp-content/uploads/2018/05/logo-grande.png"
    type="image/x-icon">

</head>

<body>
  <header>
    <img src='/demoweb/se_logo_64x64.png' alt=''>
    <div class="titulo" id="tituloGranja">GRANJA    </div>
    <div class="menu-burger">
      <span></span> <span></span> <span></span>
    </div>
  </header>

  <main>
  </main>

  <footer>
    <p>Demo API Aveva Insight.</p>
    <p id="nota"> </p>
  </footer>

  <script>
    var webUrl= "https://script.google.com/macros/s/AKfycbyFy2bJtyPOmujuC7TiraZQPPpgCgSEV8TsBMGLuhkT3Zti7air1JmTQ2XxkFSiYNzA_g/exec"

    const imgEsperaUrl="https://drive.google.com/thumbnail?id=14boOFBzVB9GCsZTdiATLFxrcKNHWmgV4"
    const urlChiste="https://script.google.com/macros/s/AKfycbxm_JkOHZ8cqKHfg-8nDn9HtRySl1QiHuBpRWqSxSrzDn4Ezzx8wNkTx2LfsLE7wRVS/exec"
    const temas=[ 
      [ "#f8f4ff", "pink", "#CC0000", "white"  ],  //  1ario, 2ario, acento, blanco
      [ "cyan", "cyan", "blue", "white"  ],
      [ "cyan", "cyan", "green", "white"  ],
    ]
    window.onload=init()
        
    function init() {
      var stGranjaCod=localStorage.getItem("granja")!=null?localStorage.getItem("granja"):"{}";
      var granjaCod = JSON.parse(stGranjaCod)
      document.getElementById("granja").value = granjaCod.granja
      document.getElementById("cod").value = granjaCod.cod

      var tema=localStorage.getItem("tema")!=null?parseInt(localStorage.getItem("tema"))-1:10;
      localStorage.setItem("tema",tema)
      cambiarTema()

      cargarHTML()
      const devicePixelRatio = window.devicePixelRatio;
      if (devicePixelRatio <= 2) {
        const root = document.documentElement;
        root.style.setProperty('--header-size', '6vw');
        root.style.setProperty('font-size', '2vw');
      }
    }
  
    function info() {
      const anchoPantalla = window.innerWidth;
      const resPantalla = window.devicePixelRatio
      document.getElementById("nota").textContent = " width: " + anchoPantalla + ", res: " + resPantalla;
    }

      async function cargarHTML() {
      
      document.getElementById("logForm").classList.add("oculto");
      document.getElementById("elemento1").innerHTML = "<div style='text-allign:center; width=100%'><img  style='margin: 0 auto;  display: block;'  src='"+ imgEsperaUrl +"' alt='Recopilando datos'></div> <br><br>"

      try {
        
        const formData= new FormData(document.getElementById("logForm"))
        const granjaInput= document.getElementById("granja").value
        const codInput= document.getElementById("cod").value

        url = webUrl + "?file=bloque";

        const response = await fetch(url, {
            method: 'POST',
            body: formData,
        })

      resp = await response.json()

      if (resp.html == "NoAuth") {
          document.getElementById("elemento1").innerHTML = "<div style='color:red; text-align:center;'><br> INDICA UNA GRANJA Y CLAVE VALIDOS </div>"
          document.getElementById("tituloGranja").innerHTML = "GRANJA";
          document.getElementById("selectGranja").classList.remove("oculto");
        } else {
          document.getElementById("elemento1").innerHTML =resp.html
          document.getElementById("tituloGranja").innerHTML =  granjaInput.toUpperCase() 
          var valor = JSON.stringify({ granja: granjaInput, cod: codInput })
          localStorage.setItem('granja', valor);
          document.getElementById("logForm").classList.add("oculto");
          document.getElementById("selectGranja").classList.remove("oculto");
        }
      } catch (error) {
        document.getElementById("elemento1").innerHTML = "<div style='color:red; text-align:center;'><br> FALLO EN LA CONSULTA DE DATOS </div>"
        document.getElementById("elemento1").innerHTML = error
        document.getElementById("tituloGranja").innerHTML = "GRANJA";
        document.getElementById("selectGranja").classList.remove("oculto");
      }  
    }

    function verLogForm(){
        document.getElementById("logForm").classList.remove("oculto");
        document.getElementById("selectGranja").classList.add("oculto");
    }

    async function chiste(){ 
        const url="https://script.google.com/macros/s/AKfycbxm_JkOHZ8cqKHfg-8nDn9HtRySl1QiHuBpRWqSxSrzDn4Ezzx8wNkTx2LfsLE7wRVS/exec"
        const elem1 = document.getElementById("elemento1") 
        const elemTitulo=document.getElementById("tituloGranja")

        elem1.innerHTML = "<div style='text-allign:center; width=100%'><img  style='margin: 0 auto;  display: block;'  src='https://drive.google.com/thumbnail?id=14boOFBzVB9GCsZTdiATLFxrcKNHWmgV4' alt=''></div> <br><br>"

        fetch(url) 
          .then (response=>{ return response.text()})
          .then (data=>{
              elem1.innerHTML= "<div class='marco chiste'>" + data + "</div>";
              elemTitulo.innerHTML="CHISTE MALO";
          })
    }

    function acercade(){ 
        const elem1 = document.getElementById("elemento1") 
        const elemTitulo=document.getElementById("tituloGranja")

        elem1.innerHTML = "<div class='marco'><h3>Demo conexi√≥n datos AVEVA INSIGHT</h3><p>Realizada por OscarHR con Google Apps Script.</p><p>04/01/2025</p></div> <br><br>"
    }

    function cambiarTema() {
            var tema=localStorage.getItem("tema")!=null?parseInt(localStorage.getItem("tema")):10;
            tema = tema < (temas.length-1) ? tema+1:0;
            localStorage.setItem("tema",tema);
            const root = document.documentElement;
            root.style.setProperty('--color-primario', temas[tema][0]);
            root.style.setProperty('--color-secundario', temas[tema][1]);
            root.style.setProperty('--color-acento',temas[tema][2]);
    }

    const menuButton = document.querySelector('.menu-burger');
    const menu = document.querySelector('nav');
    menuButton.addEventListener('click', () => {
      menu.classList.toggle('active');
    });

    document.addEventListener('click', (event) => {
      if (!event.target.closest('nav') && !event.target.closest('.menu-burger')) {
        menu.classList.remove('active');
      };
    });
    function closeMenu(){ document.querySelector('nav').classList.remove('active')     }
  </script>
</body>

</html>
